schema briefly_document {
    document briefly_document {
        field user_id type string {
            indexing: attribute
            attribute: fast-search
        }
        
        field doc_id type string {
            indexing: attribute | summary
            attribute: fast-search
        }
        
        field provider type string {
            indexing: attribute | summary
            attribute: fast-search
        }
        
        field source_type type string {
            indexing: attribute | summary
            attribute: fast-search
        }
        
        field title type string {
            indexing: index | summary
            index: enable-bm25
        }
        
        field content type string {
            indexing: index | summary
            index: enable-bm25
        }
        
        field search_text type string {
            indexing: index | summary
            index: enable-bm25
        }
        
        field sender type string {
            indexing: attribute | summary
            attribute: fast-search
        }
        
        field recipients type array<string> {
            indexing: attribute | summary
            attribute: fast-search
        }
        
        field thread_id type string {
            indexing: attribute | summary
            attribute: fast-search
        }
        
        field folder type string {
            indexing: attribute | summary
            attribute: fast-search
        }
        
        field created_at type long {
            indexing: attribute | summary
            attribute: fast-search
        }
        
        field updated_at type long {
            indexing: attribute | summary
            attribute: fast-search
        }
        
        field quoted_content type string {
            indexing: index | summary
            index: enable-bm25
        }
        
        field thread_summary type map<string, string> {
            indexing: summary
        }
        
        field metadata type map<string, string> {
            indexing: summary
        }
        
        field embedding type tensor<float>(x[384]) {
            indexing: attribute
            attribute {
                distance-metric: angular
            }
        }
    }
    
    fieldset default {
        fields: title, content, search_text, quoted_content
    }
    
    rank-profile hybrid inherits default {
        first-phase {
            expression: nativeRank(title, content, search_text)
        }
        second-phase {
            expression: 0.3 * nativeRank(title, content, search_text) + 0.7 * closeness(field, embedding)
        }
        match-features: nativeRank(title, content, search_text) closeness(field, embedding)
    }
    
    rank-profile bm25 inherits default {
        first-phase {
            expression: bm25(title) + bm25(content) + bm25(search_text)
        }
    }
    
    rank-profile semantic inherits default {
        first-phase {
            expression: closeness(field, embedding)
        }
    }
}
