[tox]
envlist = format, lint, typecheck, test

[gh-actions]
python =
    3.12: py312

[testenv]
deps = -r{toxinidir}/requirements.txt
setenv =
    PYTHONPATH = {toxinidir}

[testenv:format]
deps = black
       isort
commands =
    black --check --diff services/
    isort --check-only --diff services/

[testenv:lint]
deps = ruff
commands =
    ruff check services/

[testenv:typecheck]
deps = mypy
       types-requests
       types-pytz
       sqlmodel
       -r{toxinidir}/requirements.txt
commands =
    mypy services/chat_service/history_manager.py --ignore-missing-imports --no-strict-optional
    mypy services/chat_service/api.py --ignore-missing-imports --no-strict-optional
    mypy services/chat_service/main.py --ignore-missing-imports --no-strict-optional
    mypy services/office_service/models/ --ignore-missing-imports --no-strict-optional
    mypy services/user_management/models/ --ignore-missing-imports --no-strict-optional
    mypy services/user_management/database.py --ignore-missing-imports --no-strict-optional
    mypy services/user_management/services/user_service.py --ignore-missing-imports --no-strict-optional

[testenv:test]
deps = pytest
       -r{toxinidir}/requirements.txt
commands =
    pytest services/chat_service/tests/ -v

[testenv:cov]
deps = pytest
       pytest-cov
       -r{toxinidir}/requirements.txt
commands =
    pytest services/chat_service/tests/ --cov=services/chat_service --cov-report=xml --cov-report=term-missing

[testenv:py312]
deps = {[testenv:test]deps}
commands = {[testenv:test]commands}
